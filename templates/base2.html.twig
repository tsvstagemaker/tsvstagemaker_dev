<!DOCTYPE html>
<html lang="{{ app.request.locale }}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="msapplication-square70x70logo" content="images/TSM_small.png" />        
        <meta name="msapplication-square150x150logo" content="images/TSM_medium.png" />
        <meta name="msapplication-wide310x150logo" content="images/TSM_wide.png" />
        <meta name="msapplication-square310x310logo" content="images/TSM_large.png" />
        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-TileImage" content="images/icon.png">
        <meta name="application-name" content="TSV STAGE MAKER">
        <title>{% block title %}Welcome!{% endblock %}</title>


        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
        {# <link rel="preconnect" href="https://fonts.gstatic.com"> #}
		<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">		
		<link rel="stylesheet" href="{{ asset('css/navbar-style.css') }}" />
		<link rel="stylesheet" href="{{ asset('css/match-style.css') }}" />
		<link rel="stylesheet" href="{{ asset('css/stage-style.css') }}" />
		<link rel="stylesheet" href="{{ asset('css/main-style.css') }}" />
        {% block stylesheets %}{% endblock %}
    </head>
     <body>

  {% if app.user %}
{# Navbar if connected#}    
<nav class="navbar navbar-expand-xl navbar-light bg-light fixed-top">
	<a class="navbar-brand" href="{{ path('app_home') }}"><img src="{{ asset('images/logo_navbar.png') }}" alt="logo ipsc tsv stage maker">TSV STAGE MAKER</a>
	{# <a href="#" class="navbar-brand"><i class="fa fa-cube"></i>Brand<b>Name</b></a>  #} 		
	<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
		<span class="navbar-toggler-icon"></span>
	</button>
	<!-- Collection of nav links, forms, and other content for toggling -->
	<div id="navbarCollapse" class="collapse navbar-collapse justify-content-start">		
		{# <form class="navbar-form form-inline">
			<div class="input-group search-box">								
				<input type="text" id="search" class="form-control" placeholder="Search here...">
				<span class="input-group-addon"><i class="material-icons">&#xE8B6;</i></span>
			</div>
		</form> #}
		<div class="navbar-nav ml-auto">
			<a href="{{ path('app_home') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_home' %}active{% endif %}"><i class="fa fa-home"></i><span>Home</span></a>
			<a href="{{ path('app_about') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_about' %}active{% endif %}"><i class="fa fa-info-circle"></i><span>About</span></a>
            <a href="{{ path('app_contact') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_contact' %}active{% endif %}"><i class="fa fa-envelope"></i><span>Contact</span></a>
			<a href="{{ path('app_allstage') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_allstage' %}active{% endif %}"><i class="fa fa-share-alt-square"></i><span>AllStages</span></a>
            <a href="{{ path('app_match_create') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_match_create' %}active{% endif %}"><i class="fa fa-share-alt-square"></i><span>New Match</span></a>
            <a href="{{ path('app_stage_create') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_stage_create' %}active{% endif %}"><i class="fa fa-share-alt-square"></i><span>New Stage</span></a>
			{# <a href="{{ path('app_home') }}" class="nav-item nav-link"><i class="fa fa-pie-chart"></i><span>Reports</span></a> #}
			<a href="#" class="nav-item nav-link"><i class="fa fa-gears"></i><span>Admin</span></a>					
			{# <a href="#" class="nav-item nav-link"><i class="fa fa-bell"></i><span>Notifications</span></a> #}
			<div class="nav-item dropdown">
			<a href="#" data-toggle="dropdown" class="nav-item nav-link dropdown-toggle user-action">
				 {% if app.user.avatarName == null %}
			        <img src="{{ asset('images/logo_navbar.png') | imagine_filter('thumb') }}" alt="Avatar user" class="avatar" alt="Avatar"> {{ app.user.firstname|capitalize }} 
			        {% else %}
			          <img src="{{ vich_uploader_asset(app.user,'avatarFile') | imagine_filter('thumb') }}" alt="Avatar user" class="avatar" alt="Avatar"> {{ app.user.firstname|capitalize }} 
			     {% endif %}				
				<b class="caret"></b>
				</a>

				<div class="dropdown-menu">
					<a href="{{ path('profile') }}" class="dropdown-item"><i class="fa fa-user-o"></i> Profile</a>
					<a href="{{ path('app_matchs') }}" class="dropdown-item {% if current_menu is defined and current_menu == 'app_matchs' %}active{% endif %}"><i class="fa fa-list"></i> Matchs</a>
					<a href="{{ path('app_stages') }}" class="dropdown-item {% if current_menu is defined and current_menu == 'app_stages' %}active{% endif %}"><i class="fa fa-list-ol"></i> Stages</a>
					<div class="divider dropdown-divider"></div>

					<a href="#" onclick="event.preventDefault(); document.getElementById('js-logout-form').submit();" class="dropdown-item"><i class="material-icons logout-icon">&#xE8AC;</i> Logout</a>
					<form id="js-logout-form" action="{{ path('app_logout') }}" method="POST" style="display: none;">
						<input type="hidden" name="_csrf_token" value="{{ csrf_token('logout') }}">
					</form>
				</div>
			</div>
		</div>
	</div>
</nav>
{# Navbar #}

{% else %}
{# Navbar if not connected#}    
<nav class="navbar navbar-expand-xl navbar-light bg-light fixed-top">
	<a class="navbar-brand" href="{{ path('app_home') }}"><img src="{{ asset('images/logo_navbar.png') }}" alt="logo ipsc tsv stage maker">TSV STAGE MAKER</a>
	{# <a href="#" class="navbar-brand"><i class="fa fa-cube"></i>Brand<b>Name</b></a>  #} 		
	<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
		<span class="navbar-toggler-icon"></span>
	</button>
	<!-- Collection of nav links, forms, and other content for toggling -->
	<div id="navbarCollapse" class="collapse navbar-collapse justify-content-start">	
		<div class="navbar-nav ml-auto">
			<a href="{{ path('app_home') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_home' %}active{% endif %}"><i class="fa fa-home"></i><span>Home</span></a>
			<a href="{{ path('app_about') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_about' %}active{% endif %}"><i class="fa fa-info-circle"></i><span>About</span></a>
            <a href="{{ path('app_contact') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_contact' %}active{% endif %}"><i class="fa fa-envelope"></i><span>Contact</span></a>
			<a href="{{ path('app_allstage') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_allstage' %}active{% endif %}"><i class="fa fa-share-alt-square"></i><span>AllStages</span></a>			
			<a href="{{ path('app_login') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_login' %}active{% endif %}"><i class="material-icons login-icon">&#xE8AC;</i><span>Login</span></a>
			<a href="{{ path('app_register') }}" class="nav-item nav-link {% if current_menu is defined and current_menu == 'app_register' %}active{% endif %}"><i class="fa fa-sign-in"></i><span>Register</span></a>	
		
		</div>
	</div>
</nav>
{# Navbar #}
 {% endif %}

         {{ include('layouts/partials/_flash_messages.html.twig') }}  

      
{% block body %}{% endblock %}
      

         {{ include('layouts/partials/_footer2.html.twig') }} 


        
        {% block javascripts %} 

<!--librairie jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

<!--jspdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js"></script>      
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
<!--html2canvas -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
{# Monscript calcule de point et drag and drop #}
<script src="{{ asset('js/scriptJS.js') }}" type="text/jscript"></script>
<!-- Alertify -->
<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
<!--touch-punch pour dragand drop mobile -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script> 




{# <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> #}
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

{# <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script> #}

{# <script src="https://kit.fontawesome.com/c017fc67b1.js" crossorigin="anonymous"></script> #}
<!-- JavaScript -->
<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>


<script>
//script pour capturer l'image du stage
function uploadFile() {
window.scrollTo(0, 0); //scroll page entiere du haut en bas 
        html2canvas(document.getElementById("main"),{scale: 2}).then(function(canvas){ //creation image avec scale: 2-> qualité X2
            var doc = new jsPDF();
            // doc.setFontSize(40); //taille titre
                    // doc.text(40, 25, "TSV STAGE MAKER") // titre
                    doc.addImage(canvas.toDataURL("image/jpeg", 0.9), 'JPEG', 5, 10, 200, 270); //'JPEG', 15(Gauche), 10 (Haut), 180 (Droite), 280 (Bas)                            
                    var blob = doc.output('blob');  

                    var image = ("image=" + canvas.toDataURL("image/jpeg", 0.9));
                    var nomstage = document.querySelector('[name="nomstage"]');
                    var numstage = document.querySelector('[name="numstage"]');
                    var FirearmId = document.querySelector('[name="FirearmId"]');
                    var TrgtTypeId = document.querySelector('[name="TrgtTypeId"]');
                    var ScoringId = document.querySelector('[name="ScoringId"]');
                    var StartOn = document.querySelector('[name="StartOn"]');
                    var StartPos = document.getElementById("StartPos");
                    var StartPos = document.querySelector('[name="StartPos"]');
                    var Descriptn = document.getElementById("Descriptn"); 
                    var Descriptn = document.querySelector('[name="Descriptn"]');
                    var CourseId = document.querySelector('[name="CourseId"]');
                    var MatchsId = document.querySelector('[name="MatchsId"]'); 
                    var MaxPoints = document.querySelector('[name="MaxPoints"]');
                    var MinRounds = document.querySelector('[name="MinRounds"]');   
                    var TrgtPaper = document.querySelector('[name="TrgtPaper"]');
                    var TrgtPlates = document.querySelector('[name="TrgtPlates"]');
                    var TrgtPenlty = document.querySelector('[name="TrgtPenlty"]');
                    var TrgtPopper = document.querySelector('[name="TrgtPopper"]'); 
                    var bobber = document.getElementById("bobber"); 
                    var StringCnt = document.querySelector('[name="StringCnt"]');
                    var ReportOn = document.querySelector('[name="ReportOn"]'); 
                    var Token = document.querySelector('[name="_token"]');
                    var sectionstage = document.getElementById("datastage");    
                    var formData = new FormData();
                    formData.append('file', blob);
                    formData.append('jpeg', image);                     
                    formData.append('nomstage', nomstage.value);
                    formData.append('numstage', numstage.value);
                    formData.append('FirearmId', FirearmId.value);
                    formData.append('TrgtTypeId', TrgtTypeId.value);
                    formData.append('ScoringId', ScoringId.value);
                    formData.append('StartOn', StartOn.value);
                    formData.append('StartPos', StartPos.value);
                    formData.append('StartPos', StartPos.innerText);
                    formData.append('Descriptn', Descriptn.value);
                    formData.append('Descriptn', Descriptn.innerText);
                    formData.append('CourseId', CourseId.value);
                    formData.append('MatchsId', MatchsId.value);
                    formData.append('MaxPoints', MaxPoints.innerText);
                    formData.append('MinRounds', MinRounds.innerText);
                    formData.append('TrgtPaper', TrgtPaper.innerText);
                    formData.append('TrgtPlates', TrgtPlates.innerText);
                    formData.append('TrgtPenlty', TrgtPenlty.innerText);
                    formData.append('TrgtPopper', TrgtPopper.innerText);
                    formData.append('bobber', bobber.innerText);
                    formData.append('StringCnt', StringCnt.value);
                    formData.append('ReportOn', ReportOn.value);
                    formData.append('_token', Token.value);
                    formData.append('datastage', sectionstage.innerHTML);
                    console.log(formData);
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function() {
                        if(this.readyState == 4 && this.status == 200) {
                            alertify.success('Your Stage has been successfully saved !');
                            return;
                        }
                    }
                    xhr.open("post", "{{ path('app_stage_create') }}",); 
                    xhr.send(formData);
                });
    }
</script>

<script>
// script pour telecharger le pdf direct sur pc
function savPDF(){
    window.scrollTo(0, 0);
    html2canvas(document.getElementById("main"),{scale: 2}).then(function(canvas){
        var doc = new jsPDF();
                // doc.setFontSize(5);
                // doc.text(40, 25, "TSV STAGE MAKER")
                doc.addImage(canvas.toDataURL("image/jpeg", 0.9), 'JPEG', 5, 10, 200, 320);//'JPEG', 15(Gauche), 10 (Haut), 180 (Droite), 280 (Bas)
                
                doc.save("stage.pdf");  

            });
};
</script>

        <!--    <script>
            // COULEURS PANNEAU

            $('#btn-orange').on("click", function() {
                $('line').css({ stroke: "#FE9301" });
            });

            $('#btn-vert').on("click", function() {
                $('rect').css({ fill: "#839B6D" });
            });

            $('#btn-vert2').on("click", function() {
                $('line').css({ stroke: "#3D963E" });
            });

            $('#btn-gris').on("click", function() {
                $('line').css({ stroke: "#C0BCBC" });
            });

            $('#btn-bleu').on("click", function() {
                $('line').css({ stroke: "#2CA8F5" }); 
            });

            $('#btn-reset').on("click", function() {   
                $('line').css({ stroke: "#FF8000" });
            });

            $("#menudroit").hide();
            $("button.menudroit").click(function() {
                $("#menudroit").toggle(1000);
            });

        </script> -->

<script>
// ALERTIFY
$(function(){
    $('.sauvegarde').click(function(event){
         alertify.set('notifier','position', 'bottom-right');                               
        alertify.notify('Please wait until the success message...', 'ajs-message.ajs-custom', 10, );
    });
    $('.telecharge').click(function(event){
        alertify.success('Download stage will start soon...');
    });
});
</script>
    
<!-- <script>       
// condition coursid si nb coup -12 ou =+ 25 
$("#ConditionCourseId").on("change",function(){
    var sel="";
    if($(this).val() <= 12){    
        sel+=' <option value="1">SHORT COURSE</option>';   
    }else if($(this).val() >= 25){    
        sel+=' <option value="3">MEDIUM COURSE</option>'; 
    }else{
        sel+=' <option value="2">LONG COURSE</option>';
    }
    $("#minrounds").html(sel);

});                                 
</script> -->

<script>    
// loader ouverture page    
function loaderspiner(){
    $('.loader-container').addClass('hidden');
}
setTimeout(loaderspiner, 3000);
</script>

<!-- Script upload fil perso objetc-->
<script type='text/javascript'>
    $(document).ready(function(){
        $('#btn_upload').click(function(){

            var fd = new FormData();
            var files = $('#file')[0].files[0];
            fd.append('file',files);

            // AJAX request
            $.ajax({
                url: 'ajaxfile.php',
                type: 'post',
                data: fd,
                contentType: false,
                processData: false,
                success: function(response){
                    if(response != 0){
                        // Show image preview
                        $('#preview').append("<img id='decor8' class='ui-widget-content ui-draggable' src='"+response+"'  title='Perso_object' alt='object'  width='100' height='100'>");
                    }else{
                        alert('file not uploaded');
                    }
                }
            });
        });
    });
</script>

<script>
    {# rotation elements #}
    var degrees = 0;
    $( ".elementRotate" ).click(function() {
        degrees += 10;
        $(this).css("transform","rotate("+degrees+"deg)");
    });
</script>

{# Redimmenssionement des images sur petit ecrans #}
<script>
    bsContainerWidth = $(document).find('.container-fluid').width()
    $(document).ready(function() {

        if (bsContainerWidth <= 768) {
            $("img").addClass("small-img");
        }  

    });
</script>

{# Button grid #}
    <script>
        function actveGrid() {
            document.getElementById("dropzone").style.background = "url( {{ asset('images/grillebleu.png') }} ) round";

        }
        function actveGrid1() {
            document.getElementById("dropzone").style.background = "url( {{ asset('images/grille2.png') }} ) round";
        }

        function actveGrid2() {
            document.getElementById("dropzone").style.background = "url( {{ asset('images/grille3.png') }} ) round";
        }

        function dactveGrid() {
            document.getElementById("dropzone").style.background = "none ";
        }
    </script>
{% endblock %}